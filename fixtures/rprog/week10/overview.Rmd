## Automating reports

###[video, videoid=bvmFjpWD4S8]knitr and R Markdown

### Why bother?

You might be used to running analyses in R (or some other software) and then copying and pasting the results (tables, plots, etc.) into a report written in Microsoft Word (or other software).

Though this might seem to be the simplest and quickest way of putting together a report, there are good reasons to move to a more unified (and more reproducible) way of producing reports.

- First of all, you might make mistakes when copying and pasting (or even retyping) the results into the Word document.
- Updating the report to take into account additions to or changes in the data can be a quite laborious process if you have replaced all the results you have copied into the document. The same applies if you find a mistake in your code and you need to rerun your analyses. 
- If you want your report to be reproducible (by others or future you) you need to archive the R script that you have used to generate the report together with the report. I am sure it has already happened to most of you that you had update a graphic in a report and you just can't find the code you have used to generate it.

In this unit we will look at [knitr](https://yihui.name/knitr/), an R package for "weaving" R code into a "tangled" document, so that the results are computed and inserted automatically. 


### Literate programming

The idea of [literate programming](https://en.wikipedia.org/wiki/Literate_programming) goes back to [Donald Knuth](https://en.wikipedia.org/wiki/Donald_Knuth):

> Let us change our traditional attitude to the construction of
> programs: Instead of imagining that our main task is to instruct a
> computer what to do, let us concentrate rather on explaining to
> humans what we want the computer to do.

Literate programming is based on the idea of combining code and prose into a single document. Initially this was done with the idea of better explaining the context and inner working of a programme, but the same idea helps with automatically generating reports. Rather than copying and pasting in a table or a plot, we include the R commands used to generate that table or plot in the report itself.

This has many advantages ...

- We avoid the many pitfalls associated with manually inserting results into a document.
- When the underlying data changes (or we fix an error in our R code), all we need to do is recompile the report.
- It will be easy to parametrise a report, so we can generate several reports from one source.
- All we need to do is archive the one source file. This helps with making your work easier to reproduce. 

Even if the main focus in data science is on automated report generation, we should not forget about the original idea of literate programming. If you write an R script performing a complex analysis, combining code and prose into a single document is an ideal tool for explaining your reasoning as to why you performed your analysis the way you have performed it. It also make it easy to insert an interpretation of the results (unfortunately, this interpretation won't update automatically when the underlying data changes). All this will help others (and future you) make better sense of your analysis. You don't want to come back to your code in a year's time and think "it made sense to me at the time, but now I have no clue what it does". This of course happens to all of us, but we would rather want to avoid it!

### How will this work?

All we need to do is agree with the computer on a convention of what is to be treated as code and what is to be treated as prose. This is typically done by using tags to delineate code. What the tags are depends on the type of document we use.

Fortunately or unfortunately, including R commands straight into a Word document is difficult. Word won't call R in the way we want and R will struggle with Word documents being a quite complex document format.

To avoid such issues, it is easier to "weave" R code into text-based document formats. The most popular choices are ...

- [Markdown](https://en.wikipedia.org/wiki/Markdown) is a simple document format using plain text formatting. Many websites (like [WordPress](https://en.support.wordpress.com/markdown/), [Stack Overflow](https://stackoverflow.com/editing-help) or [GitHub](https://guides.github.com/features/mastering-markdown/)) allow users to write content in Markdown. It is easy to convert Markdown documents to a variety of formats (including Word documents) using [Pandoc](https://pandoc.org/). 
- [LaTeX](https://en.wikipedia.org/wiki/LaTeX) is another (and much more complex and powerful) text-based format for authoring documents.
- [HTML](https://en.wikipedia.org/wiki/HTML) documents are also plain text instructions, so will be easy to insert code chunks. 

We will first look at Markdown and then quickly look at inserting code chunks into LaTeX and HTML (for those of you familiar with those formats).


<!--[if PDF]>
\newpage
<![endif]-->
