## Review exercises

For the tasks in this section you need to load a data file `t2.RData`, which you can download from

- http://www.stats.gla.ac.uk/~levers/rp/t2.RData

If you run R on a computer connected to the internet, you can simply run
```{r}
load(url("http://www.stats.gla.ac.uk/~levers/rp/t2.RData"))
```

###[task]
Read the data files [`health.txt`](http://www.stats.gla.ac.uk/~levers/rp/health.txt) and [`cia.csv`](http://www.stats.gla.ac.uk/~levers/rp/cia.csv) into R. Make sure missing values are read in correctly.

You can download the two files from:

- http://www.stats.gla.ac.uk/~levers/rp/health.txt
- http://www.stats.gla.ac.uk/~levers/rp/cia.csv

####[answer]

\mbox{ }

#####[video, videoid="YGuBj5akynQ", duration="4m48s"]Walk-through model answers


The file `health.txt` is white-space separated and the first line contains the column names. The file does not contain any missing values. 
```{r}
health <- read.table(url("http://www.stats.gla.ac.uk/~levers/rp/health.txt"), 
                     header=TRUE)
str(health)
```

The file `cia.csv` is comma-separated and the first line contains the column names. The file contains missing values coded as `"?"`. 
```{r}
cia <- read.csv(url("http://www.stats.gla.ac.uk/~levers/rp/cia.csv"), 
                na.strings="?")
str(cia)
```
####[/answer]
###[/task]


###[task, label="task_houseprices_classical"]
The data frame `houseprices` (in `t2.RData`) contains data on property sales in and around Glasgow between July 1st and December 31st 2014. It contains the following columns.

####[columns]
#####[column, width=12]

| Column name | Description    |
|-------------|----------------|
| `Day` | Day of the month of the transaction|
| `Month` | Month of the transaction (integer)|
| `Address` | Address of the property|
| `Lon` | Longitude of the property (degrees)|
| `Lat` | Latitude of the property (degrees)|
| `Price` | Price|

(Crown copyright material reproduced with the permission of Registers of Scotland.)

Give the R code which can be used to answer the questions below.

- What was the average house price in October 2014?
- How many transactions occurred between November 15th and December 15th?
- Which house sold for the lowest and which for the highest price?
- Read the help file for the function `cut` (enter `?cut` into the R console to see the help file). Use `cut` to create a new column called `PriceGroup` that takes the values "low" ($\texttt{Price}\leq 100,000$), "medium" ($100,000<\texttt{Price}\leq 250,000$), and "high" ($\texttt{Price}>250,000$).
- Create a new variable \texttt{Dist2Uni} which contains the distance to the University in kilometres.
- What was the average price of properties which are within 1km of the University?

#####[/column]
####[/columns]

*Hint:* Consider two locations with longitudes $\lambda_1$ and $\lambda_2$ and latitudes $\phi_1$ and $\phi_2$ (expressed in radians, i.e. divide the longitude and latitudes by $180^{\circ}$ and multiply by $\pi$).

Define

\begin{align*}
\Delta\lambda&={\lambda_2-\lambda_1}\\
\Delta\phi&={\phi_2-\phi_1}\\
\alpha&=\sin\left(\frac{\Delta\phi}{2}\right)^2+\cos(\phi_1)\cos(\phi_2)\cdot\sin\left(\frac{\Delta\lambda}{2}\right)^2\\
d&=12742 \tan^{-1}\left(\frac{\sqrt{\alpha}}{\sqrt{1-\alpha}}\right),
\end{align*}

then $d$ gives the distance (in kilometres) between the two locations.

The longitude and latitude of the University are:  
$\lambda={-4.2886^{\circ}}$ and $\phi={55.8711^{\circ}}$

$\tan^{-1}\left(\frac{a}{b}\right)$ can be calculated in R using the  `atan2(a, b)`.

####[answer]


\mbox{ }

#####[video, videoid="wGkh3lyoF9E", duration="8m35s"]Walk-through model answers


You can use the following R code.
```{r, echo=FALSE}
load(url("http://www.stats.gla.ac.uk/~levers/rp/t2.RData"))
```
```{r}
mean(subset(houseprices, Month==10)$Price)

nrow(subset(houseprices, (Month==11 & Day>=15) | (Month==12 & Day<=15)))

houseprices[which.min(houseprices$Price),]
houseprices[which.max(houseprices$Price),]
# The above code only shows one of the transactions for Â£1, so it might be better to 
# use the commands below
subset(houseprices, Price==min(Price))
subset(houseprices, Price==max(Price))

houseprices <- transform(houseprices, 
                         PriceGroup=cut(Price, 
                                        breaks=c(0, 1e5, 25e4, Inf),
                                        labels=c("low", "medium", "high")))

lambda1 <- houseprices$Lon / 180 * pi
phi1 <- houseprices$Lat / 180 * pi
lambda2 <- -4.2886 / 180 * pi
phi2 <-  55.8711  / 180 * pi
delta.lambda <- lambda2-lambda1
delta.phi <- phi2-phi1
alpha <- sin(delta.phi/2)^2 + cos(phi1)*cos(phi2)*sin(delta.lambda/2)^2
d <- 12742 * atan2(sqrt(alpha),sqrt(1-alpha))
houseprices <- transform(houseprices, Dist2Uni=d)
# Next week we will learn how to write functions. This lets us use
dist2uni <- function(Lon, Lat) {
    lambda1 <- Lon / 180 * pi
    phi1 <- Lat / 180 * pi
    lambda2 <- -4.2886 / 180 * pi
    phi2 <-  55.8711  / 180 * pi
    delta.lambda <- lambda2-lambda1
    delta.phi <- phi2-phi1
    alpha <- sin(delta.phi/2)^2 + cos(phi1)*cos(phi2)*sin(delta.lambda/2)^2
    12742 * atan2(sqrt(alpha),sqrt(1-alpha))
}
houseprices <- transform(houseprices, Dist2Uni=dist2uni(Lon, Lat))

mean(subset(houseprices,Dist2Uni<=1)$Price)
```
####[/answer]
###[/task]



###[task, label="task_alcohol_classic"]
 In this task you will use the table `alcohol` (available from `t2.RData`)  which contains the average weekly consumption of alcohol in UK units based on age group, gender and type of drink (data from England, 2009; data obtained from http://data.gov.uk). The data frame `alcohol` has the following columns.

| Column name  | Description |
|--------------|---------------------|
|`Drink` | Type of alcoholic drink|
|`Gender` | gender ("Men", "Women")|
|`Age` | Age group ("16-24", "25-44", "45-64", "65+")|
|`Units` | Weekly alcohol consumption in units|

- Print the alcohol consumption data relating to women aged 16-24. 
- Find the total alcohol consumption in units for women aged 16-24.
- Read the help file for the function `aggregate` (enter `?aggregate` into the R console to access the help page). Use the function `aggregrate` to create a new data set `total_alcohol` which contains the total alcohol consumption in units for both genders and each group. The table should have three columns: "Age", "Gender" and "Units". 

####[answer]


\mbox{ }

#####[video, videoid="eV1UPTAHWA0", duration="3m34s"]Walk-through model answers

You can use the following R code.
```{r, echo=FALSE}
load(url("http://www.stats.gla.ac.uk/~levers/rp/t2.RData"))
```
```{r}
subset(alcohol, Gender=="Women" & Age=="16-24")

sum(subset(alcohol, Gender=="Women" & Age=="16-24")$Units)

total_alcohol <- aggregate(Units ~ Age + Gender, data=alcohol, sum)#
total_alcohol
```
####[/answer]
###[/task]





<!--[if PDF]>
\newpage
<![endif]-->
