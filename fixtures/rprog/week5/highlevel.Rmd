## High-level functions for statistical plots


```{r, echo=FALSE}
palette(c('#000000', '#951272',  '#00843D', '#003865', '#BE4D00', '#0075B0', '#B30C00', '#FFDC36', '#00B5D1', '#7D2239',  '#AA8066', '#5B4D94', '#FFB948'))
library(magrittr)
load(url("http://www.stats.gla.ac.uk/~levers/rp/w5.RData"))
```

### Bar charts and pie charts

The function `barplot(height, ...)` can be used to create bar plots. The
vector `height` hereby contains the heights of the bars.

####[example] 
```{r, dev.args=list(pointsize=10) }
height <- 1:5 
names(height) = c("one", "two", "three", "four", "five")
barplot(height, col=rainbow(5))
```
####[/example]

####[example]
We can draw a bar plot of the average health expenditure in the example data set using the following R code.
```{r, dev.args=list(pointsize=10)}
library(dplyr)
HESummary <- health %>%                                   # Get avg health exp
                 group_by(Region) %>% 
                 summarise(HealthExpenditure=mean(HealthExpenditure))
x <- HESummary$HealthExpenditure                          # Turn into named vector
names(x) <- HESummary$Region
par(las=3, mar=c(12.1, 4.1, 4.1, 2.1))                    # Make space for labels
barplot(x)                                                # Create bar plot
title("Average Health Expenditure (USD)")
```
####[/example]

If we want to use the function `barplot` to chart frequencies of categorical variables, we first need to tabulate these using the function `table`.

####[example]
We can create a barchart of the number of countries in each region using
```{r, dev.args=list(pointsize=10)}
par(las=3, mar=c(12.1, 4.1, 4.1, 2.1))                    # Make space for labels
health %$%
    table(Region) %>%
    barplot()
title("Number of countries")
```

We have used `magrittr`'s pipe exposition operator `%$%`. We could have also used 
```r
barplot(table(health$Region))
```
####[/example]

If the argument `height` to `barplot` is a matrix the bars are shown in groups. If we use the additional argument `beside=FALSE`, the bars are stacked. 

####[example]
Let's use this to illustrate the distribution of health expenditure in the different regions. We start by discretising the health expenditure and then plotting the number of countries for each level and region.
```{r, dev.args=list(pointsize=10)}
par(las=3, mar=c(12.1, 4.1, 4.1, 2.1))      # Increase space for labels
health %>%
    mutate(HealthExpenditure=cut(HealthExpenditure,
                                 breaks=c(0,75,250,1000,10000))) %>%
    select(HealthExpenditure, Region) %>%
    table() %>%
    barplot(col=2:5)
legend("top", fill=2:5, c("<$75","$75-$200","$250-$1000",">$1000"))
```
####[/example]

We can use the function `pie(x,...)` to draw a pie chart of the proportions given by the vector `x` (which will be renormalised, if necessary).

####[example]
We can draw pie chart showing the proportions of countries which comes from each region using the following R code.
```{r, dev.args=list(pointsize=10)}
health %$%
    table(Region) %>%
    pie()
title("Number of countries")
```
####[/example]

Note that pie charts are [not ideal](https://www.perceptualedge.com/articles/visual_business_intelligence/save_the_pies_for_dessert.pdf): the human eye is better at judging lengths than angles and pie charts are essentially just about judging angles.

### Boxplots
[Boxplots](https://en.wikipedia.org/wiki/Box_plot) can be created using the function `boxplot`. 

`boxplot(y, ...)` creates a box plot of the data in the vector `y`. If `y` is a data frame then R will draw one box plot per column (using a common y axis). 

If `x` is a categorical variable then `boxplot(y~x, ...)` draws a boxplots separately for each level of `x`.

####[example]
We draw boxplots showing the distribution of the health expenditure in each region using the following R code.
```{r, dev.args=list(pointsize=10)}
par(las=3, mar=c(12.1, 4.1, 4.1, 2.1))            # Increase space for labels
health %$% boxplot(HealthExpenditure ~ Region)
```
####[/example]

####[task]
Let's return to the diamonds data from ref://plottask1. Create boxplots of the prices of diamonds as a function of cut and colour.

#####[answer]
We can use the following R code:
```{r, dev.args=list(pointsize=10)}
diamonds %$% 
   boxplot(price ~ cut)
diamonds %$% 
   boxplot(price ~ color)
```

This seems odd: the better the diamond (lower letters denote better colours). The reason for this is that we forgot to take the size of the diamond into account. Perfect diamonds tend to be small. The story changes a little if we look at the price per weight.

```{r, dev.args=list(pointsize=10)}
diamonds %$% 
   boxplot(I(price/carat) ~ cut)
diamonds %$% 
   boxplot(I(price/carat) ~ color)
```

The problem is in some way that because large diamonds are rare, they are disproportionately expensive. If we take carat to the power of 1.5 we get

```{r, dev.args=list(pointsize=10)}
diamonds %$% 
   boxplot(I(price/carat^1.5) ~ cut)
diamonds %$% 
   boxplot(I(price/carat^1.5) ~ color)
```

which looks more plausible.

The function `I` lets us perform transformations inside the plotting functions.
#####[/answer]

####[/task]

### Histograms and density plots
[Histograms](https://en.wikipedia.org/wiki/Histogram) can be created using the function `hist(x, ...)`. 

####[example]
A histogram of health expenditure can be created using ...
```{r, dev.args=list(pointsize=10)}
health %$% hist(LifeExpectancy)
```
####[/example]

R automatically chooses the breakpoints. You can use the argument `breaks` to override it: `breaks=n` forces R to use `n` breakpoints, alternatively you can set `breaks=vec`, where `vec` is a vector containing the breakpoints to be used.

A histogram is a discrete approximation to the probability density function. You can estimate the probability density function using the function `density`:

####[example]
A plot of the (estimated) density of health expenditure can be created using ...
```{r, dev.args=list(pointsize=10)}
health %$% plot(density(LifeExpectancy))
```
####[/example]

### Scatterplot matrices
We can use the function `plot` to create a scatterplot of two continuous variables. Often, data sets contain more than just two continuous variables. The function `pairs` draws a scatterplot matrix. It contains a scatter plot of every variable against every other variable.

Colour (and plotting symbols, ...) can be set in the same way as for plot.

####[example]
The fourth to sixth column of the health expenditure data contain continuous data, which we can visualise using a scatterplot matrix.
```{r, dev.args=list(pointsize=10)}
pairs(health[,4:6],
      col=1+unclass(health$Region))
```
####[/example]


## Legends

The function `legend(position, type=values, legend=legend)` can be used to add a legend to a plot. More than one `type=values` expression can be used. `legend` is the vector containing the labels to be used in the legend. `position` can be `"bottomright"`, `"bottom"`,  `"bottomleft"`, `"left"`, `"topleft"`, `"top"`, `"topright"`, `"right"`. Alternatively you can specify the coordinates of the legend.

####[example]
We will now add a legend to our plot of the health expenditure from ref://healthplot.
```{r, echo=FALSE, dev.args=list(pointsize=10)}
plot(LifeExpectancy~HealthExpenditure, data=health, col=1+unclass(Region))
health %$%
    legend("bottomright",  pch=1, col=1+1:nlevels(Region), legend=levels(Region))
title("Link between health expenditure and life expectancy")
```
```r
health %$%
    legend("bottomright",  pch=1, col=1+1:nlevels(Region), legend=levels(Region))
```
`pch=1` is needed to make sure that R uses the standard plotting symbol in the legend.
####[/example]


<!--[if PDF]>
\newpage
<![endif]-->
